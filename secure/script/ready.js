/* eslint-disable */
var keys = {
	'_': {
		'key': null,
		'name': 'space',
		'bw': '/img/1x1.png',
		'color': '/img/1x1.png',
		'letter-value': null,
		'letter-value-final': null,
	},
	'aleph': {
		'key': 0,
		'name': 'The Fool',
		'bw': '/img/323x522_bw/0-the-fool.png',
		'color': '/img/323x522/0-the-fool.png',
		'letter-value': 1,
		'letter-value-final': 1000,
	},
	'beth': {
		'key': 1,
		'name': 'The Magician',
		'bw': '/img/323x522_bw/1-the-magician.png',
		'color': '/img/323x522/1-the-magician.png',
		'letter-value': 2,
	},
	'gimel': {
		'key': 2,
		'name': 'High Priestess',
		'bw': '/img/323x522_bw/2-high-priestess.png',
		'color': '/img/323x522/2-high-priestess.png',
		'letter-value': 3,
	},
	'daleth': {
		'key': 3,
		'name': 'The Empress',
		'bw': '/img/323x522_bw/3-the-empress.png',
		'color': '/img/323x522/3-the-empress.png',
		'letter-value': 4,
	},
	'heh': {
		'key': 4,
		'name': 'The Emperor',
		'bw': '/img/323x522_bw/4-the-emperor.png',
		'color': '/img/323x522/4-the-emperor.png',
		'letter-value': 5,
	},
	'vav': {
		'key': 5,
		'name': 'Hierophant',
		'bw': '/img/323x522_bw/5-hierophant.png',
		'color': '/img/323x522/5-hierophant.png',
		'letter-value': 6,
	},
	'zain': {
		'key': 6,
		'name': 'The Lovers',
		'bw': '/img/323x522_bw/6-the-lovers.png',
		'color': '/img/323x522/6-the-lovers.png',
		'letter-value': 7,
	},
	'cheth': {
		'key': 7,
		'name': 'The Chariot',
		'bw': '/img/323x522_bw/7-the-chariot.png',
		'color': '/img/323x522/7-the-chariot.png',
		'letter-value': 8,
	},
	'teth': {
		'key': 8,
		'name': 'Strength',
		'bw': '/img/323x522_bw/8-strength.png',
		'color': '/img/323x522/8-strength.png',
		'letter-value': 9,
	},
	'yod': {
		'key': 9,
		'name': 'The Hermit',
		'bw': '/img/323x522_bw/9-the-hermit.png',
		'color': '/img/323x522/9-the-hermit.png',
		'letter-value': 10,
	},
	'kaph': {
		'key': 10,
		'name': 'Wheel of Fortune',
		'bw': '/img/323x522_bw/10-wheel-of-fortune.png',
		'color': '/img/323x522/10-wheel-of-fortune.png',
		'letter-value': 20,
		'letter-value-final': 500,
	},
	'lamed': {
		'key': 11,
		'name': 'Justice',
		'bw': '/img/323x522_bw/11-justice.png',
		'color': '/img/323x522/11-justice.png',
		'letter-value': 30,
	},
	'mem': {
		'key': 12,
		'name': 'Hanged Man',
		'bw': '/img/323x522_bw/12-hanged-man.png',
		'color': '/img/323x522/12-hanged-man.png',
		'letter-value': 40,
		'letter-value-final': 600,
	},
	'nun': {
		'key': 13,
		'name': 'Death',
		'bw': '/img/323x522_bw/13-death.png',
		'color': '/img/323x522/13-death.png',
		'letter-value': 50,
		'letter-value-final': 700,
	},
	'samekh': {
		'key': 14,
		'name': 'Temperance',
		'bw': '/img/323x522_bw/14-temperance.png',
		'color': '/img/323x522/14-temperance.png',
		'letter-value': 60,
	},
	'ayin': {
		'key': 15,
		'name': 'The Devil',
		'bw': '/img/323x522_bw/15-the-devil.png',
		'color': '/img/323x522/15-the-devil.png',
		'letter-value': 70,
	},
	'peh': {
		'key': 16,
		'name': 'The Tower',
		'bw': '/img/323x522_bw/16-the-tower.png',
		'color': '/img/323x522/16-the-tower.png',
		'letter-value': 80,
		'letter-value-final': 800,
	},
	'tzaddi': {
		'key': 17,
		'name': 'The Star',
		'bw': '/img/323x522_bw/17-the-star.png',
		'color': '/img/323x522/17-the-star.png',
		'letter-value': 90,
		'letter-value-final': 900,
	},
	'qoph': {
		'key': 18,
		'name': 'The Moon',
		'bw': '/img/323x522_bw/18-the-moon.png',
		'color': '/img/323x522/18-the-moon.png',
		'letter-value': 100,
	},
	'resh': {
		'key': 19,
		'name': 'The Sun',
		'bw': '/img/323x522_bw/19-the-sun.png',
		'color': '/img/323x522/19-the-sun.png',
		'letter-value': 200,
	},
	'shin': {
		'key': 20,
		'name': 'Judgement',
		'bw': '/img/323x522_bw/20-judgement.png',
		'color': '/img/323x522/20-judgement.png',
		'letter-value': 300,
	},
	'tav': {
		'key': 21,
		'name': 'The World',
		'bw': '/img/323x522_bw/21-the-world.png',
		'color': '/img/323x522/21-the-world.png',
		'letter-value': 400,
	},
};
keys['key-0'] = keys.aleph;
keys['key-1'] = keys.beth;
keys['key-2'] = keys.gimel;
keys['key-3'] = keys.daleth;
keys['key-4'] = keys.heh;
keys['key-5'] = keys.vav;
keys['key-6'] = keys.zain;
keys['key-7'] = keys.cheth;
keys['key-8'] = keys.teth;
keys['key-9'] = keys.yod;
keys['key-10'] = keys.kaph;
keys['key-11'] = keys.lamed;
keys['key-12'] = keys.mem;
keys['key-13'] = keys.nun;
keys['key-14'] = keys.samekh;
keys['key-15'] = keys.ayin;
keys['key-16'] = keys.peh;
keys['key-17'] = keys.tzaddi;
keys['key-18'] = keys.qoph;
keys['key-19'] = keys.resh;
keys['key-20'] = keys.shin;
keys['key-21'] = keys.tav;

$(function () {
	$('form.header').submit(function () {
		var keys = $('input[name=keys]').val().trim();
		var content = $('input[name=content]').val().trim();
		if (keys.length > 0)
			window.location.href = '/keys/' + keys;
		else if (content.length > 0)
			window.location.href = '/content/' + content;
		else
			window.location.href = '/keys';
		return false;
	});

	$('form.keys').submit(function () {
		var key = $('#input-word').val().trim();
		window.location.href = '/keys/' + key;
		return false;
	});

	$('div.word').each(function () {
		var self = $(this);
		var span_bw = self.find('span');
		var span_color = span_bw.clone();
		span_bw.after(span_color);
		var letters = span_bw.attr('class').split(' ').reverse();
		_.each(letters, function (letter) {
			var klass = 'key ' + letter;
			if (letter === '_') klass = 'space';
			var src_bw = keys[letter].bw;
			var src_color = keys[letter].color;
			var title = letter;
			var img_template = '<img class="${class}" src="${src}" title="${title}" alt="${title}" />';
			span_bw.append(img_template
				.replace('${class}', klass)
				.replace('${src}', src_bw)
				.replace(/\$\{title\}/g, title)
			);
			span_color.append(img_template
				.replace('${class}', klass)
				.replace('${src}', src_color)
				.replace(/\$\{title\}/g, title)
			);
		});
		span_bw.addClass('bw');
		span_color.addClass('color');
		var active = false;
		self.find('span.bw').click(function () {
			if (active) return;
			active = true;
			self.find('span.color').fadeIn(500);
			setTimeout(function () {
				self.find('span.color').fadeOut(500);
				setTimeout(function () {
					active = false;
				}, 500);
			}, 5000);
		});
	});

	$('div.keys').each(function () {
		var self = $(this);
		var span = self.find('span');
		var letters = span.attr('class').split(' ');
		_.each(letters, function (letter) {
			var klass = 'key ' + letter;
			if (letter === '_') klass = 'space';
			var src = keys[letter].color;
			var title = keys[letter].name;
			span.append('<img class="${class}" src="${src}" title="${title}" alt="${title}" />'
				.replace('${class}', klass)
				.replace('${src}', src)
				.replace(/\$\{title\}/g, title)
			);
		});
	});

	$('#convert').click(function () {
		var text = $('#text').val();

		// populate result
		var result = text
		.replace(/A/g, 'א')
		.replace(/B/g, 'ב')
		.replace(/G/g, 'ג')
		.replace(/D/g, 'ד')
		.replace(/H/g, 'ה')
		.replace(/V/g, 'ו')
		.replace(/Z/g, 'ז')
		.replace(/Ch/g, 'ח')
		.replace(/Tz/g, 'צ')
		.replace(/Tf/g, 'ץ')
		.replace(/Th/g, 'ת')
		.replace(/T/g, 'ט')
		.replace(/I/g, 'י')
		.replace(/Kf/g, 'ך')
		.replace(/K/g, 'כ')
		.replace(/L/g, 'ל')
		.replace(/Mf/g, 'ם')
		.replace(/M/g, 'מ')
		.replace(/Nf/g, 'ן')
		.replace(/N/g, 'נ')
		.replace(/Sh/g, 'ש')
		.replace(/S/g, 'ס')
		.replace(/O/g, 'ע')
		.replace(/Pf/g, 'ף')
		.replace(/P/g, 'פ')
		.replace(/Q/g, 'ק')
		.replace(/R/g, 'ר');
		$('#result').val(result);

		// populate spelled
		var spelled = text
		.replace(/ /g, '_ ')
		.replace(/A/g, 'aleph ')
		.replace(/B/g, 'beth ')
		.replace(/G/g, 'gimel ')
		.replace(/D/g, 'daleth ')
		.replace(/H/g, 'heh ')
		.replace(/V/g, 'vav ')
		.replace(/Z/g, 'zain ')
		.replace(/Ch/g, 'cheth ')
		.replace(/Tz/g, 'tzaddi ')
		.replace(/Tf/g, 'tzaddi ')
		.replace(/Th/g, 'tav ')
		.replace(/T/g, 'teth ')
		.replace(/I/g, 'yod ')
		.replace(/Kf/g, 'kaph ')
		.replace(/K/g, 'kaph ')
		.replace(/L/g, 'lamed ')
		.replace(/Mf/g, 'mem ')
		.replace(/M/g, 'mem ')
		.replace(/Nf/g, 'nun ')
		.replace(/N/g, 'nun ')
		.replace(/Sh/g, 'shin ')
		.replace(/S/g, 'samekh ')
		.replace(/O/g, 'ayin ')
		.replace(/Pf/g, 'peh ')
		.replace(/P/g, 'peh ')
		.replace(/Q/g, 'qoph ')
		.replace(/R/g, 'resh ')
		.trim();
		$('#spelled').val(spelled);

		// populate tarot-keys
		var html = '';
		var letters = spelled.split(' ');
		var gematria = 0;
		_.each(letters, function (letter) {
			var key = keys[letter];
			if (key) {
				gematria += key['letter-value'];
				html += '<img src="${src}" title="${title}" alt="${title}">'
					.replace(/\$\{src\}/g, key.color)
					.replace(/\$\{title\}/g, letter);
			}
		});
		$('#tarot-keys').html(html);
		$('#text-title').html(result + ' - ' + gematria);
		setImgSize($('#img-size').val());
	});

	$('#greek').click(function () {
		var text = $('#text').val();

		var result = text
		// .replace(/Th/g, 'Θ')
		// .replace(/Ph/g, 'Φ')
		// .replace(/Ch/g, 'Χ')
		// .replace(/Ps/g, 'Ψ')
		// .replace(/ O/g, ' Ω')
		// .replace(/^O/g, 'Ω')
		// .replace(/A/g,  'Α')
		// .replace(/B/g,  'Β')
		// .replace(/G/g,  'Γ')
		// .replace(/D/g,  'Δ')
		// .replace(/E/g,  'Ε')
		// .replace(/Z/g,  'Ζ')
		// .replace(/H/g,  'Η')
		// .replace(/I/g,  'Ι')
		// .replace(/K/g,  'Κ')
		// .replace(/L/g,  'Λ')
		// .replace(/M/g,  'Μ')
		// .replace(/N/g,  'Ν')
		// .replace(/X/g,  'Ξ')
		// .replace(/O/g,  'Ο')
		// .replace(/P/g,  'Π')
		// .replace(/R/g,  'Ρ')
		// .replace(/S/g,  'Σ')
		// .replace(/T/g,  'Τ')
		// .replace(/U/g,  'Υ')
		.replace(/s /g, 'ς ')
		.replace(/s$/g, 'ς')
		.replace(/th/g, 'θ')
		.replace(/ph/g, 'φ')
		.replace(/ch/g, 'χ')
		.replace(/ps/g, 'ψ')
		.replace(/O/g,  'ω')
		.replace(/a/g,  'α')
		.replace(/b/g,  'β')
		.replace(/g/g,  'γ')
		.replace(/d/g,  'δ')
		.replace(/e/g,  'ε')
		.replace(/z/g,  'ζ')
		.replace(/h/g,  'η')
		.replace(/i/g,  'ι')
		.replace(/k/g,  'κ')
		.replace(/l/g,  'λ')
		.replace(/m/g,  'μ')
		.replace(/n/g,  'ν')
		.replace(/x/g,  'ξ')
		.replace(/o/g,  'ο')
		.replace(/p/g,  'π')
		.replace(/r/g,  'ρ')
		.replace(/s/g,  'σ')
		.replace(/t/g,  'τ')
		.replace(/u/g,  'υ')
		.trim();
		$('#result').val(result);

		var spelled = text
		// .replace(/Th/g, 'theta ')
		// .replace(/Ph/g, 'phi ')
		// .replace(/Ch/g, 'chi ')
		// .replace(/Ps/g, 'psi ')
		// .replace(/ O/g, 'omega ')
		// .replace(/^O/g, 'omega ')
		// .replace(/A/g,  'alpha ')
		// .replace(/B/g,  'beta ')
		// .replace(/G/g,  'gamma ')
		// .replace(/D/g,  'delta ')
		// .replace(/E/g,  'epsilon ')
		// .replace(/Z/g,  'zeta ')
		// .replace(/H/g,  'eta ')
		// .replace(/I/g,  'iota ')
		// .replace(/K/g,  'kappa ')
		// .replace(/L/g,  'lambda ')
		// .replace(/M/g,  'mu ')
		// .replace(/N/g,  'nu ')
		// .replace(/X/g,  'xi ')
		// .replace(/O/g,  'omicron ')
		// .replace(/P/g,  'pi ')
		// .replace(/R/g,  'rho ')
		// .replace(/S/g,  'sigma ')
		// .replace(/T/g,  'tau ')
		// .replace(/U/g,  'upsilon ')
		.replace(/O/g,  'OMEGA ')
		.replace(/s /g, 'SIGMA ')
		.replace(/s$/g, 'SIGMA ')
		.replace(/th/g, 'THETA ')
		.replace(/ph/g, 'PHI ')
		.replace(/ch/g, 'CHI ')
		.replace(/ps/g, 'PSI ')
		.replace(/a/g,  'ALPHA ')
		.replace(/b/g,  'BETA ')
		.replace(/g/g,  'GAMMA ')
		.replace(/d/g,  'DELTA ')
		.replace(/e/g,  'EPSILON ')
		.replace(/z/g,  'ZETA ')
		.replace(/h/g,  'ETA ')
		.replace(/i/g,  'IOTA ')
		.replace(/k/g,  'KAPPA ')
		.replace(/l/g,  'LAMBDA ')
		.replace(/m/g,  'MU ')
		.replace(/n/g,  'NU ')
		.replace(/x/g,  'XI ')
		.replace(/o/g,  'ΟMICRON ')
		.replace(/p/g,  'PI ')
		.replace(/r/g,  'RHO ')
		.replace(/s/g,  'SIGMA ')
		.replace(/t/g,  'TAU ')
		.replace(/u/g,  'UPSILON ')
		.trim();
		$('#spelled').val(spelled.toLowerCase());
	});

	function setImgSize(value) {
		switch(value) {
			case '200p':
				$('#tarot-keys img').css({'height': '323px', 'width': '200px'});
				break;
			case '124p':
				$('#tarot-keys img').css({'height': '200px', 'width': '124px'});
				break;
			case '77p':
				$('#tarot-keys img').css({'height': '124px', 'width': '77px'});
				break;
			default:
				alert('unknown img-size: ' + value);
		}
	}

	$('#img-size').on('change', function () {
		setImgSize(this.value);
	});
});
/* eslint-enable */
